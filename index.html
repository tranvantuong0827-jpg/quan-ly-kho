<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no text-center">
    <title>Kho B·∫£o M·∫≠t - T∆∞·ªùng</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 min-h-screen">
    <div id="login-screen" class="max-w-md mx-auto p-6 pt-20">
        <div class="bg-white p-8 rounded-[2.5rem] shadow-2xl text-center space-y-6">
            <h1 class="text-4xl font-black text-blue-800">üîê</h1>
            <h2 class="text-2xl font-bold text-slate-700">X√ÅC TH·ª∞C NH√ÇN S·ª∞</h2>
            <div class="space-y-4 text-left">
                <input id="userId" type="text" placeholder="M√£ nh√¢n vi√™n" class="w-full border-0 bg-slate-100 p-4 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 font-bold">
                <input id="userPw" type="password" placeholder="M·∫≠t kh·∫©u" class="w-full border-0 bg-slate-100 p-4 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 font-bold">
                <button onclick="login()" id="btnLogin" class="w-full bg-blue-600 text-white font-black py-5 rounded-2xl shadow-lg uppercase tracking-wider">V√†o H·ªá Th·ªëng</button>
            </div>
        </div>
    </div>

    <div id="main-screen" class="hidden max-w-md mx-auto p-4 space-y-4">
        <div class="flex justify-between items-center bg-white p-4 rounded-2xl shadow-sm">
            <span id="welcomeMsg" class="font-bold text-blue-600 italic">Ch√†o T∆∞·ªùng!</span>
            <button onclick="location.reload()" class="text-xs bg-slate-100 p-2 rounded-lg text-slate-400">ƒêƒÉng xu·∫•t</button>
        </div>

        <div class="bg-white p-6 rounded-[2.5rem] shadow-xl border-white space-y-4 text-center">
            <h1 class="text-2xl font-black text-blue-800 uppercase">Kho C·ªßa T∆∞·ªùng</h1>
            <input id="pName" list="product-list" type="text" placeholder="Ch·ªçn s·∫£n ph·∫©m..." class="w-full bg-slate-50 p-4 rounded-2xl outline-none border-0 focus:ring-2 focus:ring-blue-500">
            <datalist id="product-list"></datalist>
            
            <div class="grid grid-cols-2 gap-3">
                <input id="pQty" type="number" placeholder="S·ªë l∆∞·ª£ng" class="w-full bg-slate-50 p-4 rounded-2xl outline-none border-0 text-center font-bold text-lg">
                <select id="pType" class="w-full bg-slate-50 p-4 rounded-2xl outline-none border-0 font-bold text-blue-600">
                    <option value="Nh·∫≠p">‚ûï NH·∫¨P</option>
                    <option value="Xu·∫•t">‚ûñ XU·∫§T</option>
                    <option value="Hao h·ª•t">‚ö†Ô∏è HAO H·ª§T</option>
                </select>
            </div>
            <button onclick="saveData()" id="btnSave" class="w-full bg-blue-600 text-white font-black py-5 rounded-2xl shadow-lg uppercase text-xl">L∆∞u d·ªØ li·ªáu</button>
        </div>

        <div class="bg-white p-6 rounded-[2.5rem] shadow-xl">
            <div class="flex justify-between items-center mb-4 font-black text-blue-700 italic">
                <span>T·ªíN KHO TH·ª∞C T·∫æ</span>
                <button onclick="fetchData()">üîÑ</button>
            </div>
            <div id="inventoryList" class="space-y-4">ƒêang t·∫£i...</div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "D√ÅN_LINK_SCRIPT_C·ª¶A_B·∫†N_V√ÄO_ƒê√ÇY";
        let currentUser = "";

        async function login() {
            const id = document.getElementById('userId').value;
            const pw = document.getElementById('userPw').value;
            const btn = document.getElementById('btnLogin');
            if(!id || !pw) return alert("Nh·∫≠p ƒë·ªß ID v√† Pass nh√©!");
            
            btn.innerText = "ƒêANG KI·ªÇM TRA...";
            const res = await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify({ action: "login", id: id, pw: pw }) });
            const result = await res.json();
            
            if (result.status === "success") {
                currentUser = result.name;
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-screen').classList.remove('hidden');
                document.getElementById('welcomeMsg').innerText = "Ch√†o " + currentUser + "!";
                fetchData();
            } else {
                alert("Sai ID ho·∫∑c M·∫≠t kh·∫©u r·ªìi T∆∞·ªùng ∆°i!");
                btn.innerText = "V√ÄO H·ªÜ TH·ªêNG";
            }
        }

        async function saveData() {
            const name = document.getElementById('pName').value.trim();
            const qty = parseFloat(document.getElementById('pQty').value);
            const type = document.getElementById('pType').value;
            if (!name || isNaN(qty)) return alert("Thi·∫øu th√¥ng tin!");
            
            document.getElementById('btnSave').innerText = "ƒêANG L∆ØU...";
            await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify({ name, qty, type, user: currentUser }) });
            document.getElementById('pQty').value = "";
            document.getElementById('btnSave').innerText = "L∆ØU D·ªÆ LI·ªÜU";
            fetchData();
        }

        async function fetchData() {
            const listDiv = document.getElementById('inventoryList');
            const dataList = document.getElementById('product-list');
            const res = await fetch(SCRIPT_URL);
            const data = await res.json();
            let stock = {};
            data.forEach(row => {
                const n = row[1], t = row[2], q = Number(row[3]);
                if (!stock[n]) stock[n] = 0;
                (t === "Nh·∫≠p") ? stock[n] += q : stock[n] -= q;
            });
            listDiv.innerHTML = ""; dataList.innerHTML = "";
            for (let item in stock) {
                const c = stock[item];
                listDiv.innerHTML += '<div class="flex justify-between border-b pb-2"><span class="uppercase font-bold text-slate-600">' + item + '</span><span class="font-black ' + (c<=10?'text-red-600':'text-emerald-600') + '">' + c + '</span></div>';
                dataList.innerHTML += '<option value="' + item + '">';
            }
        }
    </script>
</body>
</html>
