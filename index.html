<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Qu·∫£n L√Ω Kho - T∆∞·ªùng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #f8fafc; }
        .card { border-radius: 1.5rem; transition: all 0.3s ease; }
        .btn-active:active { transform: scale(0.96); }
    </style>
</head>
<body class="p-4 sm:p-8">
    <div class="max-w-md mx-auto space-y-6">
        <div class="text-center space-y-2">
            <h1 class="text-3xl font-extrabold text-slate-800 tracking-tight">üì¶ KHO TH√îNG MINH</h1>
            <p class="text-slate-500 text-sm">H·ªá th·ªëng qu·∫£n l√Ω c·ªßa T∆∞·ªùng</p>
        </div>

        <div class="bg-white p-6 card shadow-xl shadow-slate-200/50 border border-slate-100">
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1 ml-1">S·∫£n ph·∫©m</label>
                    <input id="pName" type="text" placeholder="T√™n s·∫£n ph·∫©m..." class="w-full bg-slate-50 border-0 p-4 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 transition-all text-slate-700">
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-1 ml-1">S·ªë l∆∞·ª£ng</label>
                        <input id="pQty" type="number" placeholder="0" class="w-full bg-slate-50 border-0 p-4 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 text-slate-700">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-1 ml-1">Ph√¢n lo·∫°i</label>
                        <select id="pType" class="w-full bg-slate-50 border-0 p-4 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 text-slate-700 appearance-none">
                            <option value="Nh·∫≠p">‚ûï Nh·∫≠p kho</option>
                            <option value="Xu·∫•t">‚ûñ Xu·∫•t kho</option>
                            <option value="Hao h·ª•t">‚ö†Ô∏è Hao h·ª•t</option>
                        </select>
                    </div>
                </div>

                <button onclick="saveData()" id="btnSave" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl shadow-lg shadow-blue-200 btn-active transition-all">
                    L∆ØU D·ªÆ LI·ªÜU NGAY
                </button>
            </div>
        </div>

        <div class="bg-white p-6 card shadow-xl shadow-slate-200/50 border border-slate-100">
            <div class="flex justify-between items-center mb-5">
                <h2 class="font-bold text-slate-800 flex items-center gap-2">
                    <span class="w-2 h-6 bg-blue-500 rounded-full"></span>
                    T·ªìn kho hi·ªán t·∫°i
                </h2>
                <button onclick="fetchData()" class="p-2 hover:bg-slate-100 rounded-full transition-colors">
                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                </button>
            </div>
            
            <div id="inventoryList" class="divide-y divide-slate-50 min-h-[100px]">
                </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyGCyQNaRq0nABoxH2u2_gpwG2mbYMKrNQzEtGDqALriuZ4CeTjPaz2ZkJK8MM_eXb1/exec";

        async function saveData() {
            const name = document.getElementById('pName').value.trim();
            const qty = parseFloat(document.getElementById('pQty').value);
            const type = document.getElementById('pType').value;
            const btn = document.getElementById('btnSave');

            if (!name || isNaN(qty)) {
                alert("B·∫°n qu√™n nh·∫≠p t√™n s·∫£n ph·∫©m ho·∫∑c s·ªë l∆∞·ª£ng r·ªìi!");
                return;
            }

            btn.disabled = true;
            btn.innerHTML = `<span class="inline-block animate-spin mr-2">‚è≥</span> ƒêANG L∆ØU...`;

            try {
                await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify({ name, qty, type }) });
                document.getElementById('pQty').value = "";
                document.getElementById('pName').value = "";
                fetchData();
            } catch (e) {
                alert("L·ªói k·∫øt n·ªëi r·ªìi T∆∞·ªùng ∆°i!");
            } finally {
                btn.disabled = false;
                btn.innerText = "L∆ØU D·ªÆ LI·ªÜU NGAY";
            }
        }

        async function fetchData() {
            const listDiv = document.getElementById('inventoryList');
            listDiv.innerHTML = `<div class="py-10 text-center text-slate-400 text-sm">ƒêang t√≠nh to√°n...</div>`;
            
            try {
                const response = await fetch(SCRIPT_URL);
                const data = await response.json();
                let stock = {};

                data.forEach(row => {
                    const [time, name, type, qty] = row;
                    if (!stock[name]) stock[name] = 0;
                    if (type === "Nh·∫≠p") stock[name] += Number(qty);
                    else stock[name] -= Number(qty);
                });

                listDiv.innerHTML = "";
                const items = Object.keys(stock);
                if (items.length === 0) {
                    listDiv.innerHTML = `<div class="py-10 text-center text-slate-400 text-sm">Kho ch∆∞a c√≥ h√†ng</div>`;
                    return;
                }

                items.forEach(item => {
                    const isLow = stock[item] <= 5;
                    listDiv.innerHTML += `
                        <div class="flex justify-between items-center py-4">
                            <div>
                                <p class="font-semibold text-slate-700 font-medium">${item}</p>
                                \${isLow ? '<span class="text-[10px] bg-red-50 text-red-500 px-2 py-0.5 rounded-full font-bold uppercase">S·∫Øp h·∫øt</span>' : ''}
                            </div>
                            <div class="text-right">
                                <p class="text-lg font-bold \${stock[item] <= 0 ? 'text-red-500' : 'text-emerald-600'}">
                                    \${stock[item].toLocaleString()}
                                </p>
                            </div>
                        </div>
                    `;
                });
            } catch (e) {
                listDiv.innerHTML = `<div class="py-10 text-center text-red-400 text-sm">Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu</div>`;
            }
        }
        fetchData();
    </script>
</body>
</html>
