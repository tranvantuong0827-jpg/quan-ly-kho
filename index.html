<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>H·ªá Th·ªëng Kho - T∆∞·ªùng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .animate-pulse-custom { animation: pulse 1s infinite; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen">

    <div id="login-screen" class="max-w-md mx-auto p-6 pt-20">
        <div class="bg-white p-8 rounded-[2.5rem] shadow-2xl text-center space-y-6 border border-white">
            <div class="text-6xl mb-2">üîì</div>
            <h2 class="text-2xl font-black text-slate-800 uppercase tracking-tight">ƒêƒÉng Nh·∫≠p Kho</h2>
            <div class="space-y-4 text-left">
                <div>
                    <label class="block text-xs font-bold text-slate-400 mb-1 ml-2">M√É NH√ÇN VI√äN</label>
                    <input id="userId" type="text" placeholder="V√≠ d·ª•: nv01" class="w-full border-0 bg-slate-100 p-4 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 font-bold">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-400 mb-1 ml-2">M·∫¨T KH·∫®U</label>
                    <input id="userPw" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full border-0 bg-slate-100 p-4 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 font-bold">
                </div>
                <button onclick="login()" id="btnLogin" class="w-full bg-blue-600 text-white font-black py-5 rounded-2xl shadow-lg hover:bg-blue-700 active:scale-95 transition-all uppercase mt-4">V√†o H·ªá Th·ªëng</button>
            </div>
        </div>
    </div>

    <div id="main-screen" class="hidden max-w-md mx-auto p-4 space-y-4">
        <div class="flex justify-between items-center bg-white p-4 rounded-2xl shadow-sm border border-white">
            <span id="welcomeMsg" class="font-bold text-blue-700 italic">ƒêang t·∫£i...</span>
            <button onclick="location.reload()" class="text-[10px] bg-red-50 px-3 py-1 rounded-full text-red-500 font-bold uppercase">Tho√°t</button>
        </div>

        <div class="bg-white p-6 rounded-[2.5rem] shadow-xl space-y-4 border border-white">
            <h1 class="text-2xl font-black text-center text-slate-800 uppercase italic">Kho C·ªßa T∆∞·ªùng</h1>
            
            <div>
                <label class="block text-xs font-bold text-slate-400 mb-1 ml-2">S·∫¢N PH·∫®M</label>
                <input id="pName" list="product-list" type="text" placeholder="Ch·ªçn ho·∫∑c nh·∫≠p m·ªõi..." class="w-full bg-slate-50 p-4 rounded-2xl outline-none border-0 focus:ring-2 focus:ring-blue-500 font-medium">
                <datalist id="product-list"></datalist>
            </div>
            
            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="block text-xs font-bold text-slate-400 mb-1 ml-2">S·ªê L∆Ø·ª¢NG</label>
                    <input id="pQty" type="number" placeholder="0" class="w-full bg-slate-50 p-4 rounded-2xl outline-none border-0 text-center font-black text-xl">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-400 mb-1 ml-2">PH√ÇN LO·∫†I</label>
                    <select id="pType" class="w-full bg-slate-50 p-4 rounded-2xl outline-none border-0 font-bold text-blue-600">
                        <option value="Nh·∫≠p">‚ûï NH·∫¨P</option>
                        <option value="Xu·∫•t">‚ûñ XU·∫§T</option>
                        <option value="Hao h·ª•t">‚ö†Ô∏è HAO H·ª§T</option>
                    </select>
                </div>
            </div>
            <button onclick="saveData()" id="btnSave" class="w-full bg-blue-600 text-white font-black py-5 rounded-2xl shadow-lg active:scale-95 transition-all text-xl uppercase">L∆∞u d·ªØ li·ªáu</button>
        </div>

        <div class="bg-white p-6 rounded-[2.5rem] shadow-xl border border-white">
            <div class="flex justify-between items-center mb-6 font-black text-blue-800 italic text-lg">
                <span>T·ªíN KHO TH·ª∞C T·∫æ</span>
                <button onclick="fetchData()" class="bg-slate-50 p-2 rounded-full">üîÑ</button>
            </div>
            <div id="inventoryList" class="space-y-4 divide-y divide-slate-50 text-sm">ƒêang t·∫£i d·ªØ li·ªáu...</div>
        </div>
    </div>

    <script>
        // LINK SCRIPT M·ªöI C·ª¶A T∆Ø·ªúNG ƒê√É ƒê∆Ø·ª¢C C·∫¨P NH·∫¨T
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx99f63pC8wwTKvMyEFcfEjoDw6EtJnSOtBIm7-Wn05xKxf7mIU0GP0c8tJd-FKuGOD/exec";
        let currentUser = "";

        async function login() {
            const id = document.getElementById('userId').value.trim();
            const pw = document.getElementById('userPw').value.trim();
            const btn = document.getElementById('btnLogin');
            if(!id || !pw) return alert("Vui l√≤ng nh·∫≠p ƒë·ªß ID v√† M·∫≠t kh·∫©u!");
            
            btn.innerText = "‚åõ ƒêANG KI·ªÇM TRA...";
            btn.disabled = true;

            try {
                const res = await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify({ action: "login", id: id, pw: pw }) });
                const result = await res.json();
                
                if (result.status === "success") {
                    currentUser = result.name;
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('main-screen').classList.remove('hidden');
                    document.getElementById('welcomeMsg').innerText = "Ch√†o: " + currentUser;
                    fetchData();
                } else {
                    alert("Sai ID ho·∫∑c M·∫≠t kh·∫©u r·ªìi T∆∞·ªùng ∆°i!");
                    btn.innerText = "V√ÄO H·ªÜ TH·ªêNG";
                    btn.disabled = false;
                }
            } catch (e) {
                alert("L·ªói k·∫øt n·ªëi! B·∫°n ki·ªÉm tra xem Apps Script ƒë√£ Tri·ªÉn khai ƒë√∫ng ch∆∞a nh√©.");
                btn.innerText = "TH·ª¨ L·∫†I";
                btn.disabled = false;
            }
        }

        async function saveData() {
            const name = document.getElementById('pName').value.trim();
            const qty = parseFloat(document.getElementById('pQty').value);
            const type = document.getElementById('pType').value;
            const btn = document.getElementById('btnSave');
            if (!name || isNaN(qty)) return alert("Nh·∫≠p ƒë·ªß th√¥ng tin h√†ng h√≥a!");
            
            btn.innerText = "‚è≥ ƒêANG L∆ØU...";
            btn.disabled = true;
            try {
                await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify({ name, qty, type, user: currentUser }) });
                document.getElementById('pQty').value = "";
                btn.innerText = "L∆ØU D·ªÆ LI·ªÜU";
                btn.disabled = false;
                fetchData();
                alert("ƒê√£ ghi nh·∫≠n bi·∫øn ƒë·ªông!");
            } catch (e) { alert("L·ªói g·ª≠i d·ªØ li·ªáu!"); btn.innerText = "L∆ØU L·∫†I"; btn.disabled = false; }
        }

        async function fetchData() {
            const listDiv = document.getElementById('inventoryList');
            const dataList = document.getElementById('product-list');
            try {
                const res = await fetch(SCRIPT_URL);
                const data = await res.json();
                let stock = {};
                data.forEach(row => {
                    const n = row[1], t = row[2], q = Number(row[3]);
                    if (!stock[n]) stock[n] = 0;
                    (t === "Nh·∫≠p") ? stock[n] += q : stock[n] -= q;
                });
                listDiv.innerHTML = ""; dataList.innerHTML = "";
                for (let item in stock) {
                    const c = stock[item];
                    const color = c <= 10 ? 'text-red-600' : 'text-emerald-600';
                    const warn = c <= 10 ? ' <span class="text-[9px] bg-red-600 text-white px-2 py-0.5 rounded animate-pulse-custom">S·∫ÆP H·∫æT</span>' : '';
                    listDiv.innerHTML += '<div class="flex justify-between items-center pt-3 pb-1 border-b border-slate-50"><div><div class="font-bold text-slate-700 uppercase">' + item + '</div>' + warn + '</div><span class="text-xl font-black ' + color + '">' + c.toLocaleString() + '</span></div>';
                    dataList.innerHTML += '<option value="' + item + '">';
                }
            } catch (e) { listDiv.innerHTML = "Ch∆∞a c√≥ d·ªØ li·ªáu t·ªìn kho."; }
        }
    </script>
</body>
</html>
