<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kho & Doanh Thu - T∆∞·ªùng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .animate-pulse-custom { animation: pulse 1s infinite; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen">

    <div id="login-screen" class="max-w-md mx-auto p-6 pt-10">
        <div class="bg-white p-8 rounded-[2.5rem] shadow-2xl text-center space-y-4 border border-white">
            <div class="text-5xl">üí∞</div>
            <h2 class="text-2xl font-black text-slate-800 uppercase italic">Kho & Doanh Thu</h2>
            <input id="userId" type="text" placeholder="M√£ nh√¢n vi√™n" class="w-full bg-slate-100 p-4 rounded-2xl outline-none font-bold border-0">
            <input id="userPw" type="password" placeholder="M·∫≠t kh·∫©u" class="w-full bg-slate-100 p-4 rounded-2xl outline-none font-bold border-0">
            <button onclick="login()" id="btnLogin" class="w-full bg-blue-600 text-white font-black py-5 rounded-2xl shadow-lg uppercase">ƒêƒÉng Nh·∫≠p</button>
        </div>
    </div>

    <div id="main-screen" class="hidden max-w-md mx-auto p-4 space-y-4">
        <div class="grid grid-cols-2 gap-3">
            <div class="bg-gradient-to-br from-blue-600 to-blue-700 p-4 rounded-3xl text-white shadow-lg">
                <p class="text-[10px] font-bold uppercase opacity-80">H√¥m nay</p>
                <p id="statDay" class="text-lg font-black tracking-tighter">0ƒë</p>
            </div>
            <div class="bg-gradient-to-br from-emerald-600 to-emerald-700 p-4 rounded-3xl text-white shadow-lg">
                <p class="text-[10px] font-bold uppercase opacity-80">Th√°ng n√†y</p>
                <p id="statMonth" class="text-lg font-black tracking-tighter">0ƒë</p>
            </div>
        </div>

        <div class="bg-white p-6 rounded-[2.5rem] shadow-xl space-y-4 border border-white text-center">
            <input id="pName" list="product-list" type="text" placeholder="T√™n s·∫£n ph·∫©m..." class="w-full bg-slate-50 p-4 rounded-2xl outline-none border-0 font-medium">
            <datalist id="product-list"></datalist>
            
            <div class="grid grid-cols-2 gap-3">
                <input id="pQty" type="number" placeholder="SL" class="w-full bg-slate-50 p-4 rounded-2xl outline-none border-0 text-center font-black">
                <input id="pPrice" type="number" placeholder="Gi√° ti·ªÅn" class="w-full bg-slate-50 p-4 rounded-2xl outline-none border-0 text-center font-black text-blue-600">
            </div>
            
            <select id="pType" class="w-full bg-slate-50 p-4 rounded-2xl outline-none border-0 font-bold text-slate-600">
                <option value="Xu·∫•t">‚ûñ B√ÅN RA (T√çNH DT)</option>
                <option value="Nh·∫≠p">‚ûï NH·∫¨P KHO</option>
                <option value="Hao h·ª•t">‚ö†Ô∏è HAO H·ª§T</option>
            </select>
            <button onclick="saveData()" id="btnSave" class="w-full bg-blue-600 text-white font-black py-5 rounded-2xl shadow-lg text-xl uppercase">L∆∞u Giao D·ªãch</button>
        </div>

        <div class="bg-white p-6 rounded-[2.5rem] shadow-xl border border-white">
            <div class="flex justify-between items-center mb-4 font-black text-slate-800 text-lg uppercase italic">
                <span>T·ªìn kho</span>
                <input type="text" id="searchInput" onkeyup="filterStock()" placeholder="üîç T√¨m..." class="w-1/2 bg-slate-100 p-2 rounded-xl text-xs outline-none border-0">
            </div>
            <div id="inventoryList" class="space-y-3 divide-y divide-slate-50">ƒêang t·∫£i...</div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "D√ÅN_LINK_SCRIPT_C·ª¶A_B·∫†N_V√ÄO_ƒê√ÇY";
        let currentUser = "";
        let fullData = [];

        async function login() {
            const id = document.getElementById('userId').value, pw = document.getElementById('userPw').value;
            const res = await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify({ action: "login", id: id, pw: pw }) });
            const result = await res.json();
            if (result.status === "success") {
                currentUser = result.name;
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-screen').classList.remove('hidden');
                fetchData();
            } else alert("Sai t√†i kho·∫£n!");
        }

        async function saveData() {
            const name = document.getElementById('pName').value, qty = document.getElementById('pQty').value, price = document.getElementById('pPrice').value, type = document.getElementById('pType').value;
            if(!name || !qty) return alert("Nh·∫≠p ƒë·ªß t√™n v√† SL!");
            document.getElementById('btnSave').innerText = "ƒêANG L∆ØU...";
            await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify({ name, qty, price, type, user: currentUser }) });
            alert("ƒê√£ l∆∞u th√†nh c√¥ng!");
            document.getElementById('pQty').value = ""; document.getElementById('pPrice').value = "";
            document.getElementById('btnSave').innerText = "L∆ØU GIAO D·ªäCH";
            fetchData();
        }

        async function fetchData() {
            const res = await fetch(SCRIPT_URL);
            fullData = await res.json();
            
            let stock = {}, revenueDay = 0, revenueMonth = 0;
            const today = new Date().toLocaleDateString();
            const thisMonth = new Date().getMonth();
            const thisYear = new Date().getFullYear();

            fullData.forEach(row => {
                const date = new Date(row[0]), name = row[1], type = row[2], qty = Number(row[3]), total = Number(row[7]) || 0;
                // T√≠nh t·ªìn kho
                if (!stock[name]) stock[name] = 0;
                (type === "Nh·∫≠p") ? stock[name] += qty : stock[name] -= qty;
                // T√≠nh doanh thu (Ch·ªâ t√≠nh lo·∫°i "Xu·∫•t")
                if (type === "Xu·∫•t") {
                    if (date.toLocaleDateString() === today) revenueDay += total;
                    if (date.getMonth() === thisMonth && date.getFullYear() === thisYear) revenueMonth += total;
                }
            });

            document.getElementById('statDay').innerText = revenueDay.toLocaleString() + "ƒë";
            document.getElementById('statMonth').innerText = revenueMonth.toLocaleString() + "ƒë";
            
            renderStock(stock);
        }

        function renderStock(stock) {
            const listDiv = document.getElementById('inventoryList');
            listDiv.innerHTML = "";
            for (let item in stock) {
                const c = stock[item];
                listDiv.innerHTML += `<div class="flex justify-between items-center py-2"><span class="font-bold text-slate-700 uppercase text-sm">${item}</span><span class="font-black ${c<=10?'text-red-600':'text-emerald-600'}">${c}</span></div>`;
            }
        }
    </script>
</body>
</html>
